<!DOCTYPE html>
<html>
<head>
    <meta http-equiv="Content-Type" content="text/html" charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />

    <title>shaheen gandhi | blog</title>
    <meta name="description" content="programming cocoa and ios" />

    <meta name="HandheldFriendly" content="True" />
    <meta name="MobileOptimized" content="320" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />

    <!-- fb open graph tags -->
    <meta property="og:title" content="" />
    <meta property="og:url" content="http://shaheengandhi.com/tag/programming/page/2/" />
    <meta property="og:site_name" content="shaheen gandhi | blog" />
    <meta property="og:type" content="blog" />

    <link rel="alternate" type="application/rss+xml" title="shaheen gandhi | blog" href="http://shaheengandhi.com/feed.xml">
    <link rel="stylesheet" type="text/css" href="/assets/css/app.css" />
    <link rel="stylesheet" type="text/css" href="//fonts.googleapis.com/css?family=Droid+Serif:400,700,400italic|Open+Sans:700,400" />
    <script src="/bower_components/modernizr/modernizr.js"></script>

<script>
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

    ga('create', 'UA-47069804-1', 'shaheengandhi.com');
    ga('send', 'pageview');

</script>
</head>
<body>
<div id="fb-root">
<script>(function(d, s, id) {
  var js, fjs = d.getElementsByTagName(s)[0];
  if (d.getElementById(id)) return;
  js = d.createElement(s); js.id = id;
  js.src = "//connect.facebook.net/en_US/all.js#xfbml=1&appId=134486209909433";
  fjs.parentNode.insertBefore(js, fjs);
}(document, 'script', 'facebook-jssdk'));</script></div>

  <div class="off-canvas-wrap">
    <div class="inner-wrap">

      <aside class="left-off-canvas-menu">
        <ul class="off-canvas-list">
          <li><label class="first">shaheen gandhi | blog</label></li>
          <li><a href="/">Home</a></li>
          <li><a href="/feed.xml">RSS</a></li>
        </ul>

        <hr />

        <ul class="off-canvas-list">
          <li><label class="first">Topics</label></li>
          <li><a href="/tag/tv">#tv (18)</a></li> <li><a href="/tag/video">#video (17)</a></li> <li><a href="/tag/apple">#apple (15)</a></li> <li><a href="/tag/programming">#programming (9)</a></li> <li><a href="/tag/cocoa">#cocoa (7)</a></li> <li><a href="/tag/ios">#ios (7)</a></li> <li><a href="/tag/mobile">#mobile (6)</a></li> <li><a href="/tag/games">#games (5)</a></li> <li><a href="/tag/gadgets">#gadgets (4)</a></li> <li><a href="/tag/personal">#personal (3)</a></li> <li><a href="/tag/film">#film (3)</a></li> <li><a href="/tag/media">#media (2)</a></li> <li><a href="/tag/osx">#osx (1)</a></li> <li><a href="/tag/microsoft">#microsoft (1)</a></li> <li><a href="/tag/creativity">#creativity (1)</a></li> <li><a href="/tag/math">#math (1)</a></li> <li><a href="/tag/tech">#tech (1)</a></li> <li><a href="/tag/hardware">#hardware (1)</a></li>
        </ul>
      </aside>

      <nav class="tab-bar hide-for-medium-up">
        <a class="left-off-canvas-toggle menu-icon show-for-small"><span>Menu</span></a>
      </nav>

      <section role="main">
        <div class="row">
          <div class="medium-8 medium-centered columns">
            <div class="row">
              <div class="large-3 medium-4 medium-uncentered columns hide-for-small sidebar">
                <div class="bio">
                  <a class="profile-picture" href="/">
                    <img src="/assets/images/profile.jpg" alt="shaheen gandhi | blog" />
                  </a>

                  <div class="author">Shaheen Gandhi</div>

                  <div class="description">
                    <p>I am a software engineer working on embedded hardware-software systems.  I built Xbox and Courier operating system internals, mobile infrastructure at Facebook, and now work at Facebook Reality Labs on the future of VR.</p>
                  </div>

                  <ul class="small-block-grid-4 social-accounts">
                    <li><a href="/feed.xml">
                      <span class="fa-stack rss">
                        <i class="fa fa-circle fa-stack-2x"></i>
                        <i class="fa fa-rss fa-stack-1x fa-inverse"></i>
                      </span>
                    </a></li>
                    <li><a href="http://twitter.com/visigoth">
                      <span class="fa-stack twitter">
                        <i class="fa fa-circle fa-stack-2x"></i>
                        <i class="fa fa-twitter fa-stack-1x fa-inverse"></i>
                      </span>
                    </a></li>
                    <li><a href="http://facebook.com/shaheen">
                      <span class="fa-stack facebook">
                        <i class="fa fa-circle fa-stack-2x"></i>
                        <i class="fa fa-facebook fa-stack-1x fa-inverse"></i>
                      </span>
                    </a></li>
                    <li><a href="http://github.com/visigoth">
                      <span class="fa-stack github">
                        <i class="fa fa-circle fa-stack-2x"></i>
                        <i class="fa fa-github fa-stack-1x fa-inverse"></i>
                      </span>
                    </a></li>
                  </ul>
                </div>

                <!--
                <form id="subscribe_form" action="http://shaheengandhi.us2.list-manage.com/subscribe/post?u=7c5ac886805e86c7228040973&amp;id=cc1838ba6f" method="post" class="validate" target="_blank" novalidate>
                  <div class="row collapse">
                    <div class="small-10 columns">
                      <input class="email" type="email" value="" name="EMAIL" placeholder="subscribe via email" required>
                    </div>
                    <div class="small-2 columns">
                      <input type="submit" value="&#xf0a9" class="fa button postfix">
                    </div>
                  </div>
                </form>
                -->

                <nav id="archive">
                  <ul class="side-nav">
                    <li class="heading">Topics</li>
                    <li><a href="/tag/tv">#tv (18)</a></li> <li><a href="/tag/video">#video (17)</a></li> <li><a href="/tag/apple">#apple (15)</a></li> <li><a href="/tag/programming">#programming (9)</a></li> <li><a href="/tag/cocoa">#cocoa (7)</a></li> <li><a href="/tag/ios">#ios (7)</a></li> <li><a href="/tag/mobile">#mobile (6)</a></li> <li><a href="/tag/games">#games (5)</a></li> <li><a href="/tag/gadgets">#gadgets (4)</a></li> <li><a href="/tag/personal">#personal (3)</a></li> <li><a href="/tag/film">#film (3)</a></li> <li><a href="/tag/media">#media (2)</a></li> <li><a href="/tag/osx">#osx (1)</a></li> <li><a href="/tag/microsoft">#microsoft (1)</a></li> <li><a href="/tag/creativity">#creativity (1)</a></li> <li><a href="/tag/math">#math (1)</a></li> <li><a href="/tag/tech">#tech (1)</a></li> <li><a href="/tag/hardware">#hardware (1)</a></li>
                  </ul>
                </nav>
              </div>
              <div class="large-9 medium-8 medium-uncentered columns">
                <main class="content" role="main">
  
  <article class="post">
    <header class="post-header">
      <div class="post-title"><a href="/the-prime-that-wasnt">The Prime That Wasn't</a></div>
    </header>
    <section class="post-content">
      <div class="posterous_bookmarklet_entry">
      <blockquote class="posterous_short_quote">/^1?$|^(11+?)\1+$/</blockquote>

<div class="posterous_quote_citation">via <a href="http://zmievski.org/2010/08/the-prime-that-wasnt?">zmievski.org</a></div>

<p><p>A great post about a simple algorithm that determines whether a number is prime.  Of course, its simplicity does not imply quick runtime.  Regardless, the algorithm ingeniously uses regex patterns to test for factorization.  The article, I think, is more interesting in that it uncovers a bug in PHP&#39;s regular expression matching algorithm as the regex relies on backtracking.</p></div></p>

    </section>
       <footer class="post-footer">
      
      <span class="post-meta">
        <a href="http://shaheengandhi.com/the-prime-that-wasnt#comments"><fb:comments-count href="http://shaheengandhi.com/the-prime-that-wasnt"></fb:comments-count> Comments</a> //
        <i class="fa fa-calendar-o"></i><time datetime="06 April 2011">06 April 2011</time> //
        <ul class="post-tags">
          <li><a href="/tag/programming">#programming</a></li> <li><a href="/tag/math">#math</a></li>
        </ul>
      </span>
      
    </footer>

  </article>
  
  <article class="post">
    <header class="post-header">
      <div class="post-title"><a href="/ios-uiimageview-rendering-in-42">iOS: UIImageView rendering in 4.2</a></div>
    </header>
    <section class="post-content">
      <p>I&#39;ve been working on my latest project since April.  That is a long time, but life gets in the way.  Regardless, this period of time means that my app has had to make the transition to iOS 4.2.  If you&#39;ll recall my <a href="http://blog.brokenrobotllc.com/ios-cached-image-loaders">post about caching media</a>, my app loads a fair amount of media from the web and displays it all to the user.  On iOS 3.2, the images I was loading would gradually show up on the screen one by one.  Once I upgraded my iPad to 4.2, this functionality suddenly changed: the images would load all together at once.  This is bad because it takes a long time to display, decode, and render these images.  The user would have to wait many seconds before they were seen.  Since my app is so visual, this was unacceptable, so I started debugging.<p /> My first inclination was that something might have changed about how the resources were being downloaded due to differences in the way NSOperation was being handled.  I placed a bunch of debug output to find out that images were downloading the same way as before, so the problem was happening after I set the image property of the target UIImageView.<p /> I wrestled with what could be happening for a while until I realized that I was setting the property on a thread other than the UI thread.  I was also setting it within an @synchronized block.  So, I thought the lock might be causing the problem.  However, I found the entire locked area was taking 4ms of time.  When you have synchronous debug prints coming over a channel, this is a small amount of time.  So, Apple had changed the way image rendering was happening to queue things up to run in some batched run loop mode on the UI thread.<p /> I ran with this and changed the rendering operation to flip the render over to the main thread with performSelectorOnMainThread.  It worked!  I was lucky that this solved the problem as it was only a hunch.  While I had played around with performSelectorOnMainThread before, I found memory management with it is tricky and so I had stayed away from it.  I&#39;m sure there are some reference counting issues in the code now as a result of the change.<p /> Lesson learned: on iOS, perform UI changes on the main thread only.  The pain of retainCount management is worth it.<p />~s</p>

    </section>
       <footer class="post-footer">
      
      <span class="post-meta">
        <a href="http://shaheengandhi.com/ios-uiimageview-rendering-in-42#comments"><fb:comments-count href="http://shaheengandhi.com/ios-uiimageview-rendering-in-42"></fb:comments-count> Comments</a> //
        <i class="fa fa-calendar-o"></i><time datetime="04 December 2010">04 December 2010</time> //
        <ul class="post-tags">
          <li><a href="/tag/programming">#programming</a></li> <li><a href="/tag/cocoa">#cocoa</a></li> <li><a href="/tag/ios">#ios</a></li>
        </ul>
      </span>
      
    </footer>

  </article>
  
  <article class="post">
    <header class="post-header">
      <div class="post-title"><a href="/ios-scalable-scrollable-views">iOS: Scalable, Scrollable Views</a></div>
    </header>
    <section class="post-content">
      <p>I've got a Mac project I'm working on that required a scalable viewport into another view. &nbsp;Because the viewport could be a scaled version of the target view, it also needs to be scrollable. &nbsp;This sort of pattern is seen a lot in editing applications and web browsers. &nbsp;Specifically, I was looking to mimic the iPhone Simulator app. &nbsp;It took me about 10 hours of wrangling cocoa to get it to do what I wanted. &nbsp;I tried writing a custom NSClipView among other tactics, but what I found to work in the end was pretty simple.&nbsp; This technique should transfer to iOS readily.<p /> To scale the view you're inspecting, you'll likely use NSView's scaleUnitSquareToSize: selector.&nbsp; This will render the view's contents using Quartz scaling algorithms.&nbsp; However, it will not change the frame/bounds of the view.&nbsp; This is where the crux of the problem lies - the scroll extents of the scroll view would not change.&nbsp; When scaled up, the scroll view would not scroll enough of the view to see all of it.&nbsp; When scaled down, the scroll view would scroll too far and show emptiness on the sides of the document.<p /> To work around this, we will create a new document view that advertises the correct frame to the scroll view.&nbsp; It will host the true document view as a subview, without clipping it and without autoresize enabled.&nbsp; It will monitor the document view's frame and adjust accordingly.&nbsp; It will also need to know the scale of the document view, and the easiest way to handle that is to have this new host view control the scale of the document.&nbsp; Here's all the code you need:<p /> <a href="https://gist.github.com/715903">https://gist.github.com/715903/e11a0afe4245fa697e5660d4fc887eae08275bec</a><p />Once you have this code, you can call setDocumentView: on any scroll view with a HostView.&nbsp; When you need to change the scale, call setScale: (or use the property accessor) on the HostView.&nbsp; The scroll view will adjust its scroll bars accordingly.<p /> Note, however, that the scroll view's frame will not change - the scroll view's size will be the same, but the scroll bars will reflect the correct amount of data that is visible.&nbsp; If you want the scroll view to adjust its size correctly to fit the document, you will need to add some more monitoring to the document's frame size and adjust accordingly outside of the scroll view itself.<p /> ~s</p>

    </section>
       <footer class="post-footer">
      
      <span class="post-meta">
        <a href="http://shaheengandhi.com/ios-scalable-scrollable-views#comments"><fb:comments-count href="http://shaheengandhi.com/ios-scalable-scrollable-views"></fb:comments-count> Comments</a> //
        <i class="fa fa-calendar-o"></i><time datetime="25 November 2010">25 November 2010</time> //
        <ul class="post-tags">
          <li><a href="/tag/programming">#programming</a></li> <li><a href="/tag/cocoa">#cocoa</a></li> <li><a href="/tag/ios">#ios</a></li>
        </ul>
      </span>
      
    </footer>

  </article>
  
  <article class="post">
    <header class="post-header">
      <div class="post-title"><a href="/ios-http-connection-management">iOS: HTTP Connection Management</a></div>
    </header>
    <section class="post-content">
      <p>In my <a href="http://blog.brokenrobotllc.com/ios-cached-image-loaders">previous post</a>, I detailed a common software pattern that anyone writing media-rich iOS apps probably runs into, so I was surprised Apple hadn&#39;t provided a generic implementation in the SDK.  Another pattern I&#39;m running into is a prioritized and throttled HTTP connection pool.<p /> As you navigate through a media-rich application that loads resources, the resources need to be streamed in to support the user&#39;s working set.  However, it&#39;s possible the user transitions among working sets very quickly, invaliding the previous working set before all of its resources are even loaded.  For example, you can imagine a photo gallery app that has one continuous view of a large photo album.  The user may scroll through lots of photos before they are even loaded in an effort to get to the end of the album.<p /> While the cache explained in my previous post would help keep everything stable, the cache still needs to go out to storage to retrieve the photos.  In order to make things simple, developers typically write code that serially retrieves required resources, disregarding whether they are in the working set anymore.  If the cache is still interested, it will store the retrieved data.  Otherwise, it will drop it on the floor.  However, this can result in a poor user experience in the scenario above, where the user must wait for all the previously requested images to load before the ones at the bottom do.  The challenge is to make the code better to not retrieve resources once they are outside the working set.<p /> In more complex scenarios, the application may want to lazily load resources in the background while the user works on the current working set.  However, this can once again create the same poor experience if the user must wait for these background resources to complete loading before resources in the user&#39;s working set are loaded.  Even worse, these background resources may not even be visible, so the user has no idea why she is waiting!<p /> Hence the need for prioritizing HTTP connections.  To do this, one needs to assign a relative priority to each connection and place it in a pool of requests.  Once in the pool, some logic needs to decide the right connection to execute.  You can easily add more complexity by allowing multiple connections in flight.  The generic pattern here is that of a scheduler: &quot;objects&quot; become &quot;ready&quot; and are then &quot;scheduled&quot; for &quot;execution&quot; once &quot;compute resources&quot; are available.  The &quot;scheduling&quot; of an object can be simple or complex: operating systems are known for having algorithms that attempt to fairly give compute resources to lots of objects with differing priorities.  Validating the fairness of a scheduling algorithm can <a href="http://www.msteched.com/2009/NorthAmerica/WCL402">get pretty hairy</a>.  For our problem, simpler solutions are typically good enough.<p /> An orthogonal, but also related, problem one runs into when developing apps that have a lot of HTTP traffic is that of throttling.  Lots of web services want clients to throttle their connections in an effort to curtail abusive usage.  However, the HTTP library on iOS doesn&#39;t have a way to throttle a bunch of connections to the same HTTP server.  Most web services only allow a certain number of connections every period of time.  However, in an age where multiple connections to each server are the norm, that could mean several things.  Conservatively, an HTTP library could provide a static period between the closure of one connection and the opening of the next to the same server.<p /> I&#39;ve solved these problems within the context of the app that I&#39;m currently writing.  Currently, it&#39;s not the most general solution as it is tailored to the MPOAuth connection library.  Hopefully I will get some time to refactor it and throw it up on github.  Let me know if this would be useful to you!<p /> ~s</p>

    </section>
       <footer class="post-footer">
      
      <span class="post-meta">
        <a href="http://shaheengandhi.com/ios-http-connection-management#comments"><fb:comments-count href="http://shaheengandhi.com/ios-http-connection-management"></fb:comments-count> Comments</a> //
        <i class="fa fa-calendar-o"></i><time datetime="07 October 2010">07 October 2010</time> //
        <ul class="post-tags">
          <li><a href="/tag/programming">#programming</a></li>
        </ul>
      </span>
      
    </footer>

  </article>
  

  <nav class="pagination" role="pagination">
    
        <a class="newer-posts" href="tag/programming/">&larr; Newer Posts</a>
    
    <span class="page-number">Page 2 of 3</span>
    
        <a class="older-posts" href="tag/programming/page/3/">Older Posts &rarr;</a>
    
  </nav>
</main>

              </div>
            </div>
          </div>
        </div>
      </section>
      <a class="exit-off-canvas"></a>
    </div>
  </div>

  <script src="//ajax.googleapis.com/ajax/libs/jquery/1.10.2/jquery.min.js"></script>
  <script src="/bower_components/foundation/js/foundation.min.js"></script>
  <script src="/assets/js/app.js"></script>

</body>
</html>
